# 项目结构与文件树

本文件用于说明项目目录结构、模块职责与维护边界。

## 1. 顶层结构（含用途）

```text
my-yolo-test/
├─ src/                                  # 运行时核心代码（主程序、视觉、后处理、动作识别）
├─ tools/                                # 各类脚本（训练、数据处理、维护）
├─ training/                             # 训练配置与训练说明
├─ docs/                                 # 项目说明书（本目录）
├─ models/                               # 模型权重（手动放置或训练产出拷贝）
├─ datasets/                             # 数据集目录（原始/转换后/训练集）
├─ runs/                                 # Ultralytics 默认训练输出
├─ output/                               # 程序日志输出（JSONL 等）
├─ examples/                             # 示例脚本（参考用途）
├─ pyproject.toml                        # 依赖声明（uv 读取）
├─ uv.lock                               # 依赖锁定文件（uv 生成）
└─ README.md                             # 项目入口说明（简版）
```

## 2. `src/` 运行时模块树

```text
src/
├─ app.py                                # 主入口：推理主循环、参数解析、可视化、日志输出
├─ config.py                             # 路径与配置辅助函数
├─ types.py                              # 全局数据结构定义（bbox/keypoints 等）
├─ actions/
│  ├─ rules.py                           # 规则动作识别（wave/nod/shake）
│  └─ classifier.py                      # 动作分类相关（预留/扩展）
├─ contact/
│  └─ hand_object.py                     # 手-物接触判定（多点位 + mask/bbox 距离）
├─ features/
│  ├─ skeleton.py                        # 人体关键点归一化
│  └─ hand_skeleton.py                   # 手骨架连接定义（绘制用）
├─ io/
│  ├─ capture.py                         # 摄像头打开与视频源处理
│  └─ output.py                          # stdout / JSONL 输出封装
├─ postprocess/
│  ├─ object_filter.py                   # 同类去重 + 跨类冲突抑制
│  └─ object_temporal.py                 # 目标时序稳定（遮挡保持/类别投票）
└─ vision/
   ├─ pose.py                            # YOLO 姿态推理
   ├─ detect.py                          # YOLO 检测/分割推理 + 类别过滤
   ├─ hand_mediapipe.py                  # MediaPipe 手关键点封装
   ├─ hand_stabilizer.py                 # 手关键点时序稳定 + 左右手稳态分配
   ├─ hand_roi.py                        # 基于手关键点构建不对称 ROI
   ├─ class_whitelist.py                 # 从训练 YAML 解析白名单
   ├─ track.py                           # 人体追踪（track_id）
   └─ hand.py                            # 兼容模块/历史模块
```

## 3. `tools/` 脚本分层

```text
tools/
├─ maintenance/                          # 运维清理脚本
│  ├─ clean_logs.py                      # 清理 output/logs
│  └─ clean_runs.py                      # 清理 runs 训练产出
├─ datasets/                             # 数据处理脚本
│  ├─ hand/
│  │  └─ download_hand_keypoints.py      # 下载手关键点数据集样例
│  └─ segment/
│     └─ convert_coco_to_yolo_seg.py     # COCO JSON -> YOLO Seg（官方 convert_coco）
└─ train/                                # 训练脚本（按任务拆分）
   ├─ hand/
   │  └─ train_hand_keypoints.py         # 手关键点（pose）训练
   └─ segment/
      └─ train_segment_objects.py        # 分割（seg）训练，兼容官方 cfg/override 语义
```

组织原则：

- 数据处理脚本和训练脚本分开，避免命令混淆；
- 训练脚本按任务拆分（`hand` / `segment`）；
- 清理维护脚本独立，降低误操作概率；
- 所有脚本内部都支持“自动向上查找仓库根目录”，移动路径后依旧可运行。

## 4. `training/` 与 `docs/` 的边界

- `training/`：偏“执行导向”，放训练配置、训练过程说明、模板文件；
- `docs/`：偏“知识导向”，放原理、参数字典、项目架构、排障策略。

阅读顺序：

- 训练执行路径：`training/README.md`
- 架构与参数细节：`docs/`

## 5. 哪些文件最常改

### 5.1 运行效果调优

- `src/app.py`：参数入口、流程接线；
- `src/vision/hand_roi.py`：ROI 形状与外扩策略；
- `src/vision/hand_stabilizer.py`：关键点稳定和左右手一致性；
- `src/postprocess/object_filter.py`：重复检测/跨类冲突；
- `src/postprocess/object_temporal.py`：遮挡保持与类别稳定；
- `src/contact/hand_object.py`：接触点策略与阈值。

### 5.2 训练相关

- `training/configs/segment_data.yaml`
- `training/configs/custom_train.yaml`
- `tools/train/segment/train_segment_objects.py`
- `tools/datasets/segment/convert_coco_to_yolo_seg.py`

### 5.3 文档维护

- `README.md`（简版入口）
- `docs/*.md`（详细说明）
