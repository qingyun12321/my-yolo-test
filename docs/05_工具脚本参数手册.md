# 工具脚本参数手册（`tools/`）

本手册覆盖 `tools/` 目录全部脚本，分为三类：

- 训练脚本（`tools/train`）
- 数据处理脚本（`tools/datasets`）
- 维护脚本（`tools/maintenance`）

---

## 1. 分割训练脚本

脚本：`tools/train/segment/train_segment_objects.py`

运行帮助：

```bash
uv run python tools/train/segment/train_segment_objects.py --help
```

### 参数表

| 参数 | 默认值 | 允许值/范围 | 影响与备注 |
|---|---:|---|---|
| `--data` | `training/configs/segment_data.yaml` | 数据集 YAML 路径 | 对应官方 `data=...`。 |
| `--model` | `models/yolo26n-seg.pt` | 模型路径或官方模型名 | 对应官方 `model=...`。 |
| `--epochs` | `100` | 整数 `>=1` | 对应官方 `epochs=...`。 |
| `--imgsz` | `640` | 整数，内部下限 `32` | 对应官方 `imgsz=...`。 |
| `--cfg` | `None` | cfg YAML 路径 | 对应官方 `cfg=...`。 |
| `--override KEY=VALUE` | `[]` | 可重复传入 | 对应官方 `arg=value` 覆盖机制。 |
| `--device` | `None` | `cpu` / `0` / `0,1` 等 | 指定训练设备。 |
| `--multi-gpu` | `False` | 布尔开关 | 未显式 `--device` 时，自动拼接所有可见 GPU。 |
| `--batch` | `None` | 整数 `>=1` | 训练 batch 覆盖。 |
| `--workers` | `None` | 整数 `>=0` | DataLoader workers 覆盖。 |
| `--cache` / `--no-cache` | `None` | 布尔 | 图像缓存开关覆盖。 |
| `--amp` / `--no-amp` | `None` | 布尔 | 混合精度开关覆盖。 |
| `--project` | `None` | 路径 | 训练输出根目录覆盖。 |
| `--name` | `None` | 字符串 | 训练 run 名称覆盖。 |
| `--exist-ok` / `--no-exist-ok` | `True` | 布尔 | 是否允许复用同名输出目录。 |
| `--out` | `models/object-seg-finetuned.pt` | 路径 | 训练后 best.pt 拷贝目标路径。 |
| `--no-copy-best` | `False` | 布尔开关 | 不执行拷贝，只保留 `runs/...` 产物。 |

### 官方一致性说明

- 脚本会打印一条 `Official-equivalent CLI preview`；
- 可直接与官方命令进行比对：
  - `yolo segment train data=... model=... epochs=... imgsz=...`

---

## 2. 手关键点训练脚本

脚本：`tools/train/hand/train_hand_keypoints.py`

运行帮助：

```bash
uv run python tools/train/hand/train_hand_keypoints.py --help
```

### 参数表

| 参数 | 默认值 | 允许值/范围 | 影响与备注 |
|---|---:|---|---|
| `--data` | `datasets/hand-keypoints.yaml` | 数据集 YAML 路径 | 训练数据配置。 |
| `--model` | `models/yolo26n-pose.pt` | 模型路径或模型名 | pose 基础模型。 |
| `--device` | `None` | `cpu` / `0` / `0,1` 等 | 显式指定设备。 |
| `--multi-gpu` | `False` | 布尔开关 | 未显式 `--device` 时自动使用多卡。 |
| `--amp` | `False` | 布尔开关 | 启用 AMP；可能触发额外模型检查下载。 |
| `--epochs` | `100` | 整数 `>=1` | 训练轮数。 |
| `--imgsz` | `640` | 正整数 | 输入尺寸。 |
| `--out` | `models/hand-keypoints.pt` | 路径 | best.pt 拷贝目标。 |

---

## 3. COCO JSON 转 YOLO Seg 脚本

脚本：`tools/datasets/segment/convert_coco_to_yolo_seg.py`

运行帮助：

```bash
uv run python tools/datasets/segment/convert_coco_to_yolo_seg.py --help
```

### 参数表

| 参数 | 默认值 | 允许值/范围 | 影响与备注 |
|---|---:|---|---|
| `--labels-dir` | `datasets/coco-json/annotations` | 目录路径 | COCO `instances_*.json` 所在目录。 |
| `--save-dir` | `datasets/yolo-seg` | 目录路径 | 转换输出目录。 |
| `--cls91to80` / `--no-cls91to80` | `True` | 布尔 | COCO91 类到 COCO80 类映射。 |
| `--lvis` / `--no-lvis` | `False` | 布尔 | 是否使用 LVIS 模式。 |

实现基于官方：

- `ultralytics.data.converter.convert_coco(use_segments=True)`

---

## 4. 手关键点数据下载脚本

脚本：`tools/datasets/hand/download_hand_keypoints.py`

运行帮助：

```bash
uv run python tools/datasets/hand/download_hand_keypoints.py --help
```

### 参数表

| 参数 | 默认值 | 允许值/范围 | 影响与备注 |
|---|---:|---|---|
| `--url` | 官方 hand-keypoints zip 地址 | URL 字符串 | 下载源地址。 |
| `--output-dir` | `datasets` | 目录路径（相对仓库根） | 压缩包与解压目录输出位置。 |

---

## 5. 维护脚本

### 5.1 清理日志

脚本：`tools/maintenance/clean_logs.py`

```bash
uv run python tools/maintenance/clean_logs.py --help
```

参数：

| 参数 | 默认值 | 允许值/范围 | 影响与备注 |
|---|---:|---|---|
| `--dry-run` | `False` | 布尔开关 | 只展示将删除的文件，不实际删除。 |

### 5.2 清理 runs

脚本：`tools/maintenance/clean_runs.py`

```bash
uv run python tools/maintenance/clean_runs.py --help
```

参数：

| 参数 | 默认值 | 允许值/范围 | 影响与备注 |
|---|---:|---|---|
| `--dry-run` | `False` | 布尔开关 | 只展示将删除内容，不实际删除。 |

---

## 6. 常用命令清单

### 6.1 分割训练（推荐）

```bash
uv run python tools/train/segment/train_segment_objects.py \
  --data training/configs/segment_data.yaml \
  --model models/yolo26n-seg.pt \
  --epochs 100 \
  --imgsz 640 \
  --out models/object-seg-finetuned.pt
```

### 6.2 手关键点训练

```bash
uv run python tools/train/hand/train_hand_keypoints.py \
  --data datasets/hand-keypoints.yaml \
  --model models/yolo26n-pose.pt \
  --epochs 100 \
  --imgsz 640 \
  --out models/hand-keypoints.pt
```

### 6.3 训练前分割标注转换

```bash
uv run python tools/datasets/segment/convert_coco_to_yolo_seg.py \
  --labels-dir datasets/coco-json/annotations \
  --save-dir datasets/yolo-seg \
  --cls91to80
```

### 6.4 清理

```bash
uv run python tools/maintenance/clean_logs.py --dry-run
uv run python tools/maintenance/clean_runs.py --dry-run
```
