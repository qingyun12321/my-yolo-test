# 数据集格式规范

本文件明确训练前必须遵守的数据规范，包括：

- 分割任务（YOLO Seg）
- 手关键点任务（YOLO Pose/Keypoints）

---

## 1. 分割任务数据规范（重点）

### 1.1 推荐目录结构

```text
datasets/
└─ your-seg-dataset/
   ├─ images/
   │  ├─ train/
   │  ├─ val/
   │  └─ test/                # 可选
   └─ labels/
      ├─ train/
      ├─ val/
      └─ test/                # 可选
```

### 1.2 文件命名规范

- 图像与标签同名，仅扩展名不同；
- 建议统一小写英文与下划线：
  - 图像：`scene_000123.jpg`
  - 标签：`scene_000123.txt`
- 禁止同一目录下重名（大小写差异也不要依赖）。

### 1.3 标签内容（YOLO Seg）

每行一个实例，格式为：

```text
<class_id> <x1> <y1> <x2> <y2> ... <xn> <yn>
```

约束：

- 坐标为归一化值（相对图像宽高），理论范围 `[0,1]`；
- 多边形至少 3 个点（即至少 6 个坐标值）；
- `class_id` 从 `0` 开始，必须与 `names` 顺序一致。

### 1.4 `segment_data.yaml` 规范

路径：`training/configs/segment_data.yaml`

示例：

```yaml
path: datasets/your-seg-dataset
train: images/train
val: images/val
test: images/test
names:
  0: cup
  1: bottle
  2: screwdriver
```

关键规则：

- `path` 可以是相对路径（相对仓库根）或绝对路径；
- `names` 可写成 dict 或 list，但推荐 dict 显式编号；
- `names` 与标签中的 `class_id` 必须严格一一对应。

### 1.5 COCO JSON 转换输入要求

若使用 `tools/datasets/segment/convert_coco_to_yolo_seg.py`：

- `--labels-dir` 目录下应包含：
  - `instances_train.json`
  - `instances_val.json`
  - （可选）`instances_test.json`
- 标注中需要包含 segmentation 信息；
- 转换后请人工抽检部分标签，确认多边形质量。

---

## 2. 手关键点任务数据规范（可选）

### 2.1 推荐目录结构

```text
datasets/
└─ your-hand-kpts-dataset/
   ├─ images/
   │  ├─ train/
   │  ├─ val/
   │  └─ test/
   └─ labels/
      ├─ train/
      ├─ val/
      └─ test/
```

### 2.2 标签要求（YOLO Pose）

- 每行一个目标（手）；
- 包含 bbox + 关键点坐标；
- 关键点顺序必须固定（建议与模型定义一致，例如 21 点手关键点顺序）。

### 2.3 数据 YAML 关键字段

手关键点数据 YAML 通常需要：

- `path/train/val/test`
- `names`
- `kpt_shape`（关键点数与维度）
- （可选）`flip_idx`（数据增强镜像映射）

请确保训练脚本中的 `--data` 指向正确 YAML。

---

## 3. 数据质量检查清单

训练前至少完成以下检查：

1. 图像与标签数量是否一致；
2. 是否存在空标签（允许但要确认是否预期）；
3. 是否存在越界坐标或非法多边形；
4. 类别分布是否极端失衡；
5. train/val 是否存在重复或近重复帧泄漏。

---

## 4. 命名与路径最佳实践

### 4.1 类别命名

- 推荐使用短英文小写：`cup`, `bottle`, `screwdriver`；
- 避免同义词重复类别（如 `mug`/`cup` 不清晰区分）。

### 4.2 路径命名

- 避免空格、中文、特殊符号；
- 建议统一风格：`datasets/your-seg-dataset`。

### 4.3 版本管理建议

- 数据集建议按版本存档：
  - `datasets/your-seg-dataset-v1`
  - `datasets/your-seg-dataset-v2`
- 每个版本保留一份对应 YAML，保证可复现实验。

---

## 5. 与推理白名单联动注意事项

`segment_data.yaml` 中配置的 `names` 会被运行时白名单读取（`--det-whitelist-config`）。

这意味着：

- 训练类别变更后，推理白名单也会同步变化；
- 若上线前只想识别部分类别，可在运行时用：
  - `--det-whitelist-mode union` + `--det-include`
  - 或直接维护一份独立白名单 YAML。
